{"version":3,"file":"9060.js","mappings":"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","sources":["webpack://demo/../../node_modules/monaco-editor/esm/vs/base/common/numbers.js","webpack://demo/../../node_modules/monaco-editor/esm/vs/editor/common/services/languageFeatureDebounce.js","webpack://demo/../../node_modules/monaco-editor/esm/vs/platform/environment/common/environment.js","webpack://demo/../../node_modules/monaco-editor/esm/vs/platform/instantiation/common/descriptors.js","webpack://demo/../../node_modules/monaco-editor/esm/vs/platform/instantiation/common/extensions.js","webpack://demo/../../node_modules/monaco-editor/esm/vs/platform/instantiation/common/instantiation.js"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nexport function clamp(value, min, max) {\n    return Math.min(Math.max(value, min), max);\n}\nexport class MovingAverage {\n    constructor() {\n        this._n = 1;\n        this._val = 0;\n    }\n    update(value) {\n        this._val = this._val + (value - this._val) / this._n;\n        this._n += 1;\n        return this._val;\n    }\n    get value() {\n        return this._val;\n    }\n}\nexport class SlidingWindowAverage {\n    constructor(size) {\n        this._n = 0;\n        this._val = 0;\n        this._values = [];\n        this._index = 0;\n        this._sum = 0;\n        this._values = new Array(size);\n        this._values.fill(0, 0, size);\n    }\n    update(value) {\n        const oldValue = this._values[this._index];\n        this._values[this._index] = value;\n        this._index = (this._index + 1) % this._values.length;\n        this._sum -= oldValue;\n        this._sum += value;\n        if (this._n < this._values.length) {\n            this._n += 1;\n        }\n        this._val = this._sum / this._n;\n        return this._val;\n    }\n    get value() {\n        return this._val;\n    }\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\n    return function (target, key) { decorator(target, key, paramIndex); }\n};\nimport { doHash } from '../../../base/common/hash.js';\nimport { LRUCache } from '../../../base/common/map.js';\nimport { clamp, MovingAverage, SlidingWindowAverage } from '../../../base/common/numbers.js';\nimport { IEnvironmentService } from '../../../platform/environment/common/environment.js';\nimport { registerSingleton } from '../../../platform/instantiation/common/extensions.js';\nimport { createDecorator } from '../../../platform/instantiation/common/instantiation.js';\nimport { ILogService } from '../../../platform/log/common/log.js';\nimport { matchesScheme } from '../../../base/common/network.js';\nexport const ILanguageFeatureDebounceService = createDecorator('ILanguageFeatureDebounceService');\nvar IdentityHash;\n(function (IdentityHash) {\n    const _hashes = new WeakMap();\n    let pool = 0;\n    function of(obj) {\n        let value = _hashes.get(obj);\n        if (value === undefined) {\n            value = ++pool;\n            _hashes.set(obj, value);\n        }\n        return value;\n    }\n    IdentityHash.of = of;\n})(IdentityHash || (IdentityHash = {}));\nclass NullDebounceInformation {\n    constructor(_default) {\n        this._default = _default;\n    }\n    get(_model) {\n        return this._default;\n    }\n    update(_model, _value) {\n        return this._default;\n    }\n    default() {\n        return this._default;\n    }\n}\nclass FeatureDebounceInformation {\n    constructor(_logService, _name, _registry, _default, _min, _max) {\n        this._logService = _logService;\n        this._name = _name;\n        this._registry = _registry;\n        this._default = _default;\n        this._min = _min;\n        this._max = _max;\n        this._cache = new LRUCache(50, 0.7);\n    }\n    _key(model) {\n        return model.id + this._registry.all(model).reduce((hashVal, obj) => doHash(IdentityHash.of(obj), hashVal), 0);\n    }\n    get(model) {\n        const key = this._key(model);\n        const avg = this._cache.get(key);\n        return avg\n            ? clamp(avg.value, this._min, this._max)\n            : this.default();\n    }\n    update(model, value) {\n        const key = this._key(model);\n        let avg = this._cache.get(key);\n        if (!avg) {\n            avg = new SlidingWindowAverage(6);\n            this._cache.set(key, avg);\n        }\n        const newValue = clamp(avg.update(value), this._min, this._max);\n        if (!matchesScheme(model.uri, 'output')) {\n            this._logService.trace(`[DEBOUNCE: ${this._name}] for ${model.uri.toString()} is ${newValue}ms`);\n        }\n        return newValue;\n    }\n    _overall() {\n        const result = new MovingAverage();\n        for (const [, avg] of this._cache) {\n            result.update(avg.value);\n        }\n        return result.value;\n    }\n    default() {\n        const value = (this._overall() | 0) || this._default;\n        return clamp(value, this._min, this._max);\n    }\n}\nlet LanguageFeatureDebounceService = class LanguageFeatureDebounceService {\n    constructor(_logService, envService) {\n        this._logService = _logService;\n        this._data = new Map();\n        this._isDev = envService.isExtensionDevelopment || !envService.isBuilt;\n    }\n    for(feature, name, config) {\n        const min = config?.min ?? 50;\n        const max = config?.max ?? min ** 2;\n        const extra = config?.key ?? undefined;\n        const key = `${IdentityHash.of(feature)},${min}${extra ? ',' + extra : ''}`;\n        let info = this._data.get(key);\n        if (!info) {\n            if (this._isDev) {\n                this._logService.debug(`[DEBOUNCE: ${name}] is disabled in developed mode`);\n                info = new NullDebounceInformation(min * 1.5);\n            }\n            else {\n                info = new FeatureDebounceInformation(this._logService, name, feature, (this._overallAverage() | 0) || (min * 1.5), // default is overall default or derived from min-value\n                min, max);\n            }\n            this._data.set(key, info);\n        }\n        return info;\n    }\n    _overallAverage() {\n        // Average of all language features. Not a great value but an approximation\n        const result = new MovingAverage();\n        for (const info of this._data.values()) {\n            result.update(info.default());\n        }\n        return result.value;\n    }\n};\nLanguageFeatureDebounceService = __decorate([\n    __param(0, ILogService),\n    __param(1, IEnvironmentService)\n], LanguageFeatureDebounceService);\nexport { LanguageFeatureDebounceService };\nregisterSingleton(ILanguageFeatureDebounceService, LanguageFeatureDebounceService, 1 /* InstantiationType.Delayed */);\n","import { createDecorator } from '../../instantiation/common/instantiation.js';\nexport const IEnvironmentService = createDecorator('environmentService');\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nexport class SyncDescriptor {\n    constructor(ctor, staticArguments = [], supportsDelayedInstantiation = false) {\n        this.ctor = ctor;\n        this.staticArguments = staticArguments;\n        this.supportsDelayedInstantiation = supportsDelayedInstantiation;\n    }\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { SyncDescriptor } from './descriptors.js';\nconst _registry = [];\nexport function registerSingleton(id, ctorOrDescriptor, supportsDelayedInstantiation) {\n    if (!(ctorOrDescriptor instanceof SyncDescriptor)) {\n        ctorOrDescriptor = new SyncDescriptor(ctorOrDescriptor, [], Boolean(supportsDelayedInstantiation));\n    }\n    _registry.push([id, ctorOrDescriptor]);\n}\nexport function getSingletonServiceDescriptors() {\n    return _registry;\n}\n","/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n// ------ internal util\nexport var _util;\n(function (_util) {\n    _util.serviceIds = new Map();\n    _util.DI_TARGET = '$di$target';\n    _util.DI_DEPENDENCIES = '$di$dependencies';\n    function getServiceDependencies(ctor) {\n        return ctor[_util.DI_DEPENDENCIES] || [];\n    }\n    _util.getServiceDependencies = getServiceDependencies;\n})(_util || (_util = {}));\nexport const IInstantiationService = createDecorator('instantiationService');\nfunction storeServiceDependency(id, target, index) {\n    if (target[_util.DI_TARGET] === target) {\n        target[_util.DI_DEPENDENCIES].push({ id, index });\n    }\n    else {\n        target[_util.DI_DEPENDENCIES] = [{ id, index }];\n        target[_util.DI_TARGET] = target;\n    }\n}\n/**\n * The *only* valid way to create a {{ServiceIdentifier}}.\n */\nexport function createDecorator(serviceId) {\n    if (_util.serviceIds.has(serviceId)) {\n        return _util.serviceIds.get(serviceId);\n    }\n    const id = function (target, key, index) {\n        if (arguments.length !== 3) {\n            throw new Error('@IServiceName-decorator can only be used to decorate a parameter');\n        }\n        storeServiceDependency(id, target, index);\n    };\n    id.toString = () => serviceId;\n    _util.serviceIds.set(serviceId, id);\n    return id;\n}\n"],"names":["clamp","value","min","max","Math","MovingAverage","constructor","this","_n","_val","update","SlidingWindowAverage","size","_values","_index","_sum","Array","fill","oldValue","length","__param","paramIndex","decorator","target","key","ILanguageFeatureDebounceService","IdentityHash","_hashes","WeakMap","pool","of","obj","get","undefined","set","NullDebounceInformation","_default","_model","_value","FeatureDebounceInformation","_logService","_name","_registry","_min","_max","_cache","_key","model","id","all","reduce","hashVal","avg","default","newValue","uri","trace","toString","_overall","result","LanguageFeatureDebounceService","envService","_data","Map","_isDev","isExtensionDevelopment","isBuilt","feature","name","config","extra","info","debug","_overallAverage","values","decorators","desc","d","c","arguments","r","Object","getOwnPropertyDescriptor","Reflect","decorate","i","defineProperty","__decorate","IEnvironmentService","SyncDescriptor","ctor","staticArguments","supportsDelayedInstantiation","registerSingleton","ctorOrDescriptor","Boolean","push","getSingletonServiceDescriptors","_util","serviceIds","DI_TARGET","DI_DEPENDENCIES","getServiceDependencies","IInstantiationService","createDecorator","serviceId","has","index","Error","storeServiceDependency"],"sourceRoot":""}